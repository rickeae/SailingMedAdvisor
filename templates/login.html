<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - MedGemma Master</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .login-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
            max-width: 420px;
            width: min(100%, 460px);
        }
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-header h1 {
            color: #1a5490;
            font-size: 32px;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        .login-header .tagline {
            color: #34495e;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 18px;
            line-height: 1.4;
        }
        .login-header .description {
            color: #5a6c7d;
            font-size: 13px;
            line-height: 1.7;
            text-align: left;
            padding: 15px;
            background: #f8f9fa;
            border-left: 3px solid #1a5490;
            border-radius: 4px;
            margin-bottom: 25px;
        }
        .icon {
            font-size: 50px;
            margin-bottom: 12px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        input[type="password"], input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input[type="password"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn-login {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-login:active {
            transform: translateY(0);
        }
        .error-message {
            background: #fee;
            color: #c33;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            font-size: 14px;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            color: #95a5a6;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <div class="icon">⚕️</div>
            <h1>SailingMedAdvisor</h1>
            <p class="tagline">MedGemma-Powered Clinical Intelligence for the High Seas</p>
            <div class="description">
                Tactical medical autonomy starts here. Unlike general-purpose AI, SailingMedAdvisor is tuned specifically to the rigors of the offshore environment. By analyzing your vessel's unique pharmacy and equipment through the lens of MedGemma's specialized clinical reasoning, we provide precision triage when you are thousands of miles from the nearest shore.
            </div>
        </div>
        
        <div id="error" class="error-message"></div>
        
        <form id="loginForm">
            <div class="form-group" id="user-row">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" required placeholder="Enter your username">
            </div>
            <div class="form-group" id="pass-row">
                <label for="password">Access Password</label>
                <input type="password" id="password" name="password" required autofocus placeholder="Enter your password">
            </div>
            <button type="submit" class="btn-login" id="login-btn">Access System</button>
        </form>
        
        <div class="footer">
            Crew credentials are managed on the Settings page under "Crew Login Credentials."
        </div>
    </div>

    <script>
        const form = document.getElementById('loginForm');
        const errorDiv = document.getElementById('error');
        const passwordInput = document.getElementById('password');
        const usernameInput = document.getElementById('username');
        const userRow = document.getElementById('user-row');
        const passRow = document.getElementById('pass-row');
        const loginBtn = document.getElementById('login-btn');
        let credentialsRequired = true;

        async function hydrateAuthUI() {
            try {
                const meta = await (await fetch('/api/auth/meta', { credentials: 'same-origin' })).json();
                credentialsRequired = !!meta.has_credentials;
                if (!credentialsRequired) {
                    userRow.style.display = 'none';
                    passRow.style.display = 'none';
                    usernameInput.required = false;
                    passwordInput.required = false;
                    loginBtn.textContent = 'Enter System';
                    errorDiv.style.display = 'block';
                    errorDiv.style.background = '#eef9f1';
                    errorDiv.style.color = '#1a5490';
                    errorDiv.textContent = 'No crew login credentials are configured. Click Enter System to proceed.';
                }
            } catch (e) {
                // If meta fails, fall back to showing the form
                console.warn('Auth meta fetch failed', e);
            }
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorDiv.style.display = 'none';
            
            const password = passwordInput.value;
            const username = usernameInput.value;
            
            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    window.location.href = '/';
                } else {
                    errorDiv.textContent = data.error || 'Invalid password';
                    errorDiv.style.display = 'block';
                    passwordInput.value = '';
                    usernameInput.focus();
                }
            } catch (error) {
                errorDiv.textContent = 'Connection error. Please try again.';
                errorDiv.style.display = 'block';
            }
        });

        hydrateAuthUI();
    </script>
</body>
</html>
