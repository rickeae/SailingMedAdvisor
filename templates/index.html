<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MedGemma Master v5.7</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --page-width: clamp(960px, 80vw, 1400px); --banner-height: 60px; --triage: #c1121f; --inquiry: #2e7d32; --green: #2e7d32; --red: #c62828; --dark: #2c3e50; --bg: #f4f7f6; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow-y: auto; }
        .nav { background: var(--dark); display: flex; padding: 0 12px; min-height: var(--banner-height); align-items: center; flex-shrink: 0; max-width: var(--page-width); width: 100%; margin: 0 auto; box-sizing: border-box; gap: 8px; position: sticky; top: 0; z-index: 1000; }
        .page-shell { max-width: var(--page-width); margin: 0 auto; width: 100%; box-sizing: border-box; }
        .tab { color: white; background: none; border: none; padding: 10px 15px; cursor: pointer; font-weight: 700; flex: 1; text-align: center; }
        .tab.active { color: #ffd54f; background: var(--inquiry); border-radius: 4px; }
        .tab-triage.active { background: var(--triage); }
        .tab-triage { flex: 1.2; font-weight: 900; }
        .tab-nowrap { white-space: nowrap; }
        .tab-config { color: white; }
        .content { flex-grow: 1; padding: 15px; overflow-y: auto; display: none; flex-direction: column; background: var(--bg); min-height: calc(100vh - var(--banner-height) - 20px); }
        .page-shell { max-width: var(--page-width); margin: 0 auto; width: 100%; box-sizing: border-box; }
        .page-body { display: flex; gap: 16px; align-items: stretch; width: 100%; position: relative; }
        .page-body.sidebar-open .page-main { margin-right: 340px; padding-right: 24px; }
        .page-body.sidebar-collapsed .page-main { margin-right: 70px; padding-right: 16px; }
        .page-main { flex: 1; min-width: 0; display: flex; flex-direction: column; transition: padding-right 0.25s ease, margin-right 0.25s ease; }
        .page-main > .page-shell,
        .page-main > .panel-wrapper,
        .page-main > .history-wrapper { max-width: 100%; width: 100%; }
        .page-sidebar { position: absolute; right: 0; top: 0; bottom: 0; width: 320px; min-width: 260px; max-width: 380px; background: #fff; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 6px 20px rgba(0,0,0,0.07); display: flex; flex-direction: column; transition: width 0.25s ease, min-width 0.25s ease; overflow: hidden; }
        .page-sidebar.collapsed { width: 38px; min-width: 38px; }
        .sidebar-toggle { background: none; border: none; padding: 10px; cursor: pointer; font-weight: 800; text-align: left; display: flex; align-items: center; gap: 8px; color: var(--dark); }
        .sidebar-toggle:hover { background: #f5f5f5; }
        .sidebar-content { padding: 0 14px 14px 14px; overflow-y: auto; flex: 1; }
        .page-sidebar.collapsed .sidebar-content { display: none; }
        .sidebar-section { border-bottom: 1px solid #eee; padding: 12px 0; }
        .sidebar-section:last-child { border-bottom: none; }
        .sidebar-title { font-weight: 800; color: var(--dark); margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }
        .sidebar-body { color: #4a5568; font-size: 13px; line-height: 1.5; }
        .sidebar-section.hidden { display: none; }
        .sidebar-pill { background: #f0f4f8; color: #2c3e50; padding: 3px 8px; border-radius: 999px; font-size: 11px; font-weight: 700; }
        /* Triage page sizing */
        #Chat .triage-wrapper { min-height: 80vh; }
        
        .banner { padding: 12px 20px; color: white; font-weight: 900; display: flex; align-items: center; gap: 12px; flex-wrap: wrap; border-radius: 0; background: var(--triage); transition: 0.3s; max-width: var(--page-width); margin: 0 auto; box-sizing: border-box; min-height: var(--banner-height); box-shadow: 0 4px 12px rgba(0,0,0,0.15); position: sticky; top: var(--banner-height); z-index: 900; }
        .banner-controls { display: none; align-items: center; gap: 10px; flex: 1; min-width: 320px; flex-wrap: wrap; }
        .banner-controls select { padding: 10px; font-weight: bold; }
        .banner-controls button { height: 44px; }
        .banner-label { font-weight: 700; }
        .mode-toggle { padding: 10px 16px; font-weight: 800; color: var(--dark); border: 1px solid #ccc; border-radius: 6px; cursor: pointer; min-width: 140px; background: white; }
        .banner.inquiry-mode { background: var(--inquiry); }
        /* Neutralize glow when logging is on (no privacy) */
        .banner.no-privacy { box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .banner.private-mode { box-shadow: 0 4px 12px rgba(0,0,0,0.2); }

        .triage-wrapper { max-width: var(--page-width); margin: 0 auto; border: 1px solid #ddd; border-top: none; display: flex; flex-direction: column; flex: 1; width: 100%; }
        .chat-area { background: white; border-radius: 0; border: none; display: flex; flex-direction: column; flex: 1; min-height: 0; width: 100%; }
        .chat-area > div { width: 100%; box-sizing: border-box; }
        .display { flex-grow: 1; padding: 20px; overflow-y: auto; background:#fff; border:1px solid #e0e0e0; border-radius:6px; min-height:180px; max-height:70vh; }
        .response-block { border-left: 6px solid var(--inquiry); padding: 15px; margin: 15px 0; background: #f9f9f9; }
        .history-list { display: flex; flex-direction: column; gap: 8px; }
        .history-item { border: 1px solid #ddd; border-radius: 6px; background: #fff; }
        .history-header { padding: 6px 10px; display: flex; align-items: center; cursor: pointer; font-weight: bold; gap: 10px; min-height: 38px; }
        .history-body { padding: 10px 12px; border-top: 1px solid #eee; display: none; }
        .history-wrapper { max-width: var(--page-width); width: 100%; margin: 0 auto; border: 1px solid #ddd; background: #fff; padding: 15px; box-sizing: border-box; }
        .panel-wrapper { max-width: var(--page-width); width: 100%; margin: 0 auto; border: 1px solid #ddd; background: #fff; padding: 15px; box-sizing: border-box; }
        .history-response { margin: 0; }
        .history-action-btn { min-width: 90px; visibility: hidden; justify-content: center; }
        .history-title { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .history-arrow { font-size: 18px; width: 18px; text-align: center; }
        .crew-med-header { padding: 6px 10px !important; min-height: 38px; display: flex; align-items: center; gap: 10px; }
        .dev-tag { display: none; background: #fff5d7; color: #8a5a00; border: 1px dashed #e0b15c; border-radius: 4px; padding: 2px 6px; font-size: 11px; font-weight: 800; letter-spacing: 0.2px; text-transform: uppercase; }
        .mode-developer .dev-tag { display: inline-block; }
        .mode-user .user-adv-only { display: none !important; }
        #CrewMedical .crew-med-header { background: #fff; font-size: 16px; }
        #VesselCrewInfo .panel-wrapper { font-size: 15px; }
        #VesselCrewInfo .col-body { font-size: 15px; }
        #VesselCrewInfo .col-body label { font-size: 13px !important; }
        #VesselCrewInfo .col-body input,
        #VesselCrewInfo .col-body select,
        #VesselCrewInfo .col-body textarea { font-size: 15px; }

        .collapsible { background: white; border: 1px solid #ddd; margin-bottom: 4px; border-radius: 4px; }
        .col-header { padding: 8px 12px; cursor: pointer; background: #f8f9fa; display: flex; justify-content: space-between; font-weight: bold; font-size: 14px; }
        .col-body { padding: 12px; display: none; }
        .compact-textarea { height: 80px; font-size: 13px; }
        .btn-row { display: flex; gap: 8px; margin-top: 10px; }
        .btn-sm { padding: 6px 12px; font-size: 13px; }
        .crew-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .btn { padding: 10px 20px; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: opacity 0.3s; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        #priv-btn { border: 1px solid #222; color: white; }
        #priv-btn.is-private { border: 2px solid #fff; }
        .config-card { background: white; padding: 25px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 20px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; color: var(--dark); }
        textarea { width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 10px; box-sizing: border-box; font-family: inherit; }
        
        .loading-indicator { color: #666; font-style: italic; padding: 10px; animation: pulse 1.5s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* Mobile-friendly tweaks */
        @media (max-width: 768px) {
            body { font-size: 15px; }
            .page-shell { padding: 0 10px; }
            .panel-wrapper, .history-wrapper, .triage-wrapper { border-radius: 0; }
            .btn, .btn-sm { width: 100%; justify-content: center; box-sizing: border-box; }
            .btn-row { flex-direction: column; }
            .collapsible .col-body { padding: 10px !important; }
            .collapsible .col-header { padding: 10px !important; }
            .triage-wrapper textarea,
            #msg,
            #prompt-preview { font-size: 15px; }
            #medication-add-body .col-body,
            #medication-add-body .col-header,
            #equipment-add-body .col-body,
            #equipment-add-body .col-header,
            #consumables-add-body .col-body,
            #consumables-add-body .col-header { padding: 10px !important; }
            #medication-add-body [style*="grid"] { grid-template-columns: 1fr !important; }
            #equipment-add-body [style*="grid"] { grid-template-columns: 1fr !important; }
            #consumables-add-body [style*="grid"] { grid-template-columns: 1fr !important; }
            #vessel-info [style*="grid-template-columns"] { grid-template-columns: 1fr !important; }
            #crew-info-list [style*="grid-template-columns"] { grid-template-columns: 1fr !important; }
            #med-photo-input { width: 100%; }
            #med-photo-drop { width: 100%; min-height: 100px; }
            #medication-add-body button,
            #equipment-add-body button,
            #consumables-add-body button,
            #medication-add-body input,
            #medication-add-body select,
            #medication-add-body textarea { width: 100%; box-sizing: border-box; }
            .page-sidebar { position: static; width: 100%; box-shadow: none; margin-top: 10px; }
            .page-body { flex-direction: column; }
            .page-body.sidebar-open .page-main,
            .page-body.sidebar-collapsed .page-main { margin-right: 0; padding-right: 0; }
        .page-sidebar .sidebar-toggle { width: 100%; justify-content: center; }
        .nav { flex-wrap: wrap; }
        .tab { flex: 1 1 50%; }
    }
    .desktop-block { display: block; }
    .phone-block { display: none; }
    #phone-import-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.55);
        z-index: 5000;
        align-items: center;
        justify-content: center;
        padding: 16px;
        box-sizing: border-box;
        overflow-y: auto;
    }
    .phone-import-panel {
        width: min(860px, 98vw);
        min-height: 78vh;
        max-height: none;
        overflow-y: auto;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 14px 40px rgba(0,0,0,0.22);
        padding: 14px;
        box-sizing: border-box;
        font-size: 30px;
        line-height: 1.5;
    }
    #phone-import-overlay { font-size: 30px; }
    #phone-import-overlay * { font-size: inherit !important; }
    .phone-import-actions { display: flex; flex-direction: column; gap: 8px; }
    .phone-import-step { font-weight: 800; color: #1f2d3d; font-size: 30px; }
    @media (max-width: 900px) {
        .desktop-block { display: none; }
        .phone-block { display: block; }
        .phone-import-panel { width: 100%; min-height: 130vh; }
        }
    </style>
</head>
<body>

<div class="nav">
    <button class="tab tab-triage active" onclick="showTab(event, 'Chat')">MEDGEMMA CHAT</button>
    <button class="tab tab-nowrap" onclick="showTab(event, 'CrewMedical')">CREW HEALTH & LOG</button>
    <button class="tab" onclick="showTab(event, 'OnboardEquipment')">MEDICAL CHEST</button>
    <button class="tab" onclick="showTab(event, 'VesselCrewInfo')">VESSEL & CREW</button>
    <button class="tab tab-config" onclick="showTab(event, 'Settings')">SETTINGS</button>
</div>

<div class="page-shell">
        <div id="banner" class="banner">
        <div id="banner-controls-triage" class="banner-controls" style="display:flex;">
            <button id="mode-toggle" class="mode-toggle" onclick="toggleMode()">TRIAGE CHAT</button>
        </div>
        <div id="banner-controls-crew" class="banner-controls" style="justify-content:space-between; gap:12px;">
            <div style="display:flex; gap:12px; align-items:center; flex:1;">
                <select id="crew-sort" onchange="loadData()" style="padding:10px; font-size:15px;">
                <option value="last">Sort: Last Name</option>
                <option value="first">Sort: First Name</option>
                <option value="birthdate-asc">Sort: Birthdate (Youngest First)</option>
                <option value="birthdate-desc">Sort: Birthdate (Oldest First)</option>
            </select>
                <button id="crew-med-export-all-btn" onclick="exportAllMedical()" class="btn btn-sm" style="background:var(--inquiry); display:none;">ðŸ“¤ Export All Medical</button>
            </div>
            <button id="crew-csv-btn" onclick="exportCrewList()" class="btn btn-sm" style="background:var(--inquiry); display:none; align-self:center;">ðŸ“‹ Crew List CSV</button>
        </div>
    </div>
</div>

<div id="Chat" class="content" style="display:flex;">
            <div class="page-shell">
                <div class="page-body sidebar-open">
                    <div class="page-main">
                        <div class="triage-wrapper">
                            <div class="chat-area">
                    <div class="collapsible" style="margin-bottom:12px;">
                        <div id="query-form-header" class="col-header crew-med-header" data-pref-key="query-form-open" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start; align-items:center;">
                            <span class="dev-tag">dev:triage-form</span>
                            <span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¾</span><span id="query-form-title" style="font-weight:700;">New Triage Chat</span>
                        </div>
                        <div id="query-form-body" class="col-body" style="padding:16px; background:#f4f4f4; display:block;">
                            <div style="margin-bottom:12px; display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                                <span style="display:flex; align-items:center; gap:6px; font-weight:800; color:var(--dark); min-width:160px;">
                                    Crew Member Receiving Care
                                    <span class="dev-tag">dev:triage-patient</span>
                                </span>
                                <select id="p-select" style="flex:1; max-width:320px; padding:10px; font-weight:700; min-width:220px;"></select>
                                <select id="model-select" style="flex:1; max-width:280px; padding:10px; font-weight:700; min-width:200px;">
                                    <option value="google/medgemma-1.5-4b-it">medgemma-1.5-4b-it (local)</option>
                                    <option value="google/medgemma-27b-text-it">medgemma-27b-text-it (local)</option>
                                </select>
                                <button onclick="togglePriv()" id="priv-btn" class="btn" style="background:#555; min-width:140px;">LOGGING: ON</button>
                            </div>
                            <div style="display:flex; align-items:center; gap:6px; margin-bottom:6px;">
                                <span class="dev-tag">dev:triage-message</span>
                            </div>
                            <textarea id="msg" style="height:105px;" placeholder="Describe what's happening"></textarea>
                            <div class="collapsible" style="margin-top:12px;">
                                <div id="prompt-preview-header" class="col-header crew-med-header user-adv-only" style="background:#fff; justify-content:flex-start; align-items:center;" role="button" aria-expanded="false" tabindex="0">
                                    <span class="dev-tag">dev:triage-prompt</span>
                                    <span class="detail-icon history-arrow" style="font-size:16px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Prompt Injection</span>
                                </div>
                                <div id="prompt-preview-container" class="col-body user-adv-only" style="padding:10px; background:#fff; display:none;">
                                    <textarea id="prompt-preview" style="width:100%; min-height:140px; padding:10px; border:1px solid #ccc; border-radius:4px;"></textarea>
                                    <div id="prompt-refresh-row" style="display:flex; justify-content:space-between; align-items:center; margin-top:6px; flex-wrap:wrap; gap:8px;">
                                        <div style="color:#555; font-size:12px;">Edits here apply only to this submission. Use Settings to change defaults.</div>
                                        <button onclick="refreshPromptPreview(true)" class="btn btn-sm" style="background:var(--inquiry);">Refresh from Settings</button>
                                    </div>
                                </div>
                            </div>
                            <div style="display:flex; gap:10px; margin-top:10px; align-items:center; flex-wrap:wrap;">
                                <button onclick="runChat()" id="run-btn" class="btn" style="flex-grow:1; background:var(--triage); min-width:160px;">SUBMIT FOR TRIAGE</button>
                                <button onclick="repeatLast()" id="repeat-btn" class="btn user-adv-only" style="background:#555; min-width:120px;">REPEAT LAST</button>
                            </div>
                        </div>
                    </div>
                    <div style="display:flex; justify-content:flex-end; margin-bottom:6px;">
                        <button onclick="clearDisplay()" class="btn btn-sm" style="background:#c62828;">Clear</button>
                    </div>
                    <div style="display:flex; align-items:center; gap:6px; margin-bottom:4px;">
                        <span class="dev-tag">dev:triage-display</span>
                    </div>
                    <div id="display" class="display"></div>
                    </div>
                </div>
            </div>
            <div class="page-sidebar" data-tab="Chat" onclick="toggleSidebar(this)">
                <div style="display:flex; align-items:center; gap:6px;">
                    <button class="sidebar-toggle">Context â†’</button>
                    <span class="dev-tag">dev:triage-sidebar</span>
                </div>
                <div class="sidebar-content">
                    {% include 'sidebars/sidebar_chat.html' %}
                </div>
            </div>
        </div>
    </div>
</div>

<div id="CrewMedical" class="content">
    <div class="page-shell">
        <div class="page-body sidebar-open">
            <div class="page-main">
                <div class="page-shell">
                    <div class="history-wrapper" data-sidebar-id="crew-medical-section">
                        <div style="display:flex; align-items:center; gap:6px; margin-bottom:6px;">
                            <span class="dev-tag">dev:crew-health-list</span>
                        </div>
                        <div id="crew-medical-list"></div>
                    </div>
                </div>
            </div>
            <div class="page-sidebar" data-tab="CrewMedical" onclick="toggleSidebar(this)">
                <div style="display:flex; align-items:center; gap:6px;">
                    <button class="sidebar-toggle">Context â†’</button>
                    <span class="dev-tag">dev:crew-sidebar</span>
                </div>
                <div class="sidebar-content">
                    {% include 'sidebars/sidebar_crew_medical.html' %}
                </div>
            </div>
        </div>
    </div>
</div>

<div id="OnboardEquipment" class="content">
    <div class="page-shell">
        <div class="page-body sidebar-open">
            <div class="page-main">
                <div class="page-shell">
                    <div class="panel-wrapper" data-sidebar-id="equipment-section">
                        <div class="collapsible">
                            <div class="col-header crew-med-header" data-sidebar-id="equipment-medication-section" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                <span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Pharmaceuticals</span><span class="dev-tag">dev:medicines-shell</span>
                            </div>
                            <div class="col-body" style="padding:12px; display:none;">
                                <div class="collapsible" style="margin-bottom:12px;">
                                    <div class="col-header crew-med-header" data-sidebar-id="equipment-medication-inventory" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                        <span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Pharmaceuticals</span><span class="dev-tag">dev:pharmacy-inventory</span>
                                    </div>
                                    <div class="col-body" style="padding:12px; background:#f8f9fa; display:none;">
                                        <div class="dev-tag" style="margin-bottom:6px;">dev:pharmacy-controls</div>
                                        <div class="dev-tag" style="margin-bottom:6px;">dev:pharmacy-list</div>
                                        <div id="pharmacy-list"></div>
                                    </div>
                                </div>
                                <div class="collapsible" style="margin-bottom:12px;">
                                    <div id="medication-add-header" class="col-header crew-med-header" data-sidebar-id="equipment-medication-add" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                        <span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Add Pharmaceuticals</span><span class="dev-tag">dev:medication-add</span>
                                    </div>
                                    <div id="medication-add-body" class="col-body" style="padding:12px; background:#f8f9fa; display:none;">
                                        <div class="collapsible" style="margin-bottom:12px;">
                                            <div class="col-header crew-med-header" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                                <span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Manual Entry</span><span class="dev-tag">dev:medication-add-form</span>
                                            </div>
                                            <div class="col-body" style="padding:10px; background:#fff; display:none;">
                                        <div style="display:grid; grid-template-columns: repeat(2, minmax(240px, 1fr)); gap:10px; margin-bottom:10px;">
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Medication Name *</label>
                                                <input id="med-new-name" type="text" style="width:100%; padding:8px;" placeholder="e.g., Amoxicillin">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Category *</label>
                                                <input id="med-new-cat" type="text" style="width:100%; padding:8px;" placeholder="Medication">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Type</label>
                                                <select id="med-new-type" style="width:100%; padding:8px;">
                                                    <option value="medication">Medication</option>
                                                    <option value="consumable">Consumable (one-time)</option>
                                                    <option value="durable">Durable (reusable)</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Storage Location</label>
                                                <input id="med-new-loc" type="text" style="width:100%; padding:8px;" placeholder="Pharmacy Locker">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Sub-Location / Kit</label>
                                                <input id="med-new-subloc" type="text" style="width:100%; padding:8px;" placeholder="Top shelf, bin A">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Parent Kit ID</label>
                                                <input id="med-new-parent" type="text" style="width:100%; padding:8px;" placeholder="Pharmacy">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Current Status</label>
                                                <select id="med-new-status" style="width:100%; padding:8px;">
                                                    <option value="In Stock">In Stock</option>
                                                    <option value="In Use">In Use</option>
                                                    <option value="Sterilizing">Sterilizing</option>
                                                    <option value="Damaged/Out of Service">Damaged/Out of Service</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Expiry Date</label>
                                                <input id="med-new-exp" type="date" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Last Inspection Date</label>
                                                <input id="med-new-inspect" type="date" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Battery Type & Status</label>
                                                <input id="med-new-batt" type="text" style="width:100%; padding:8px;" placeholder="n/a or pack info">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Calibration Due Date</label>
                                                <input id="med-new-cal" type="date" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Total Quantity</label>
                                                <input id="med-new-qty" type="number" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Minimum Par Level</label>
                                                <input id="med-new-par" type="number" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Supplier / Manufacturer</label>
                                                <input id="med-new-sup" type="text" style="width:100%; padding:8px;" placeholder="Vendor">
                                            </div>
                                            <div style="grid-column: span 2;">
                                                <label style="font-weight:700; font-size:12px;">Notes</label>
                                                <textarea id="med-new-notes" style="width:100%; padding:8px; min-height:60px;"></textarea>
                                            </div>
                                        </div>
                                        <button onclick="addMedicationItem()" class="btn btn-sm" style="background:var(--dark); width:100%;">Add Pharmaceutical</button>
                                            </div>
                                        </div>
                                        <div class="collapsible" style="margin-top:12px;">
                                            <div class="col-header crew-med-header" data-sidebar-id="equipment-medication-intake" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                                <span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Import From Photo</span><span class="dev-tag">dev:med-photo-import</span>
                                            </div>
                                            <div class="col-body" style="padding:12px; background:#eef4ff; display:none;">
                                                <div class="dev-tag" style="margin-bottom:8px;">dev:med-photo-controls</div>
                                                <div style="display:flex; flex-direction:column; gap:8px; align-items:flex-start; margin-bottom:10px;">
                                                    <button class="btn btn-sm phone-only" style="background:#1f2d3d; min-width:180px;" onclick="openPhoneImportView()"><span class="dev-tag">dev:med-photo-mobile-btn</span>Phone Camera Helper</button>
                                                    <div style="font-size:12px; color:#444;">Step 1: Choose or Take Photo(s)</div>
                                                    <input id="med-photo-input" type="file" accept="image/*" multiple style="padding:6px; font-size:13px;">
                                                    <div id="med-photo-drop" class="dev-tag" style="display:flex; align-items:center; justify-content:center; width:100%; min-height:80px; border:2px dashed #ccc; border-radius:8px; background:#fafbff; color:#444; font-size:12px; padding:10px; box-sizing:border-box;">
                                                        <span>Drag and drop photos here</span>
                                                    </div>
                                                    <div id="med-photo-selected" style="font-size:12px; color:#2c3e50;">No files selected.</div>
                                                    <div id="med-photo-preview" style="display:flex; flex-wrap:wrap; gap:8px;"></div>
                                                    <div style="font-size:12px; color:#444;">Step 2: Add to queue</div>
                                                    <button class="btn btn-sm" style="background:var(--dark); min-width:180px;" onclick="queueMedicinePhotos()">Queue Photos</button>
                                                    <div style="font-size:12px; color:#444;">Step 3: Run queue</div>
                                                    <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
                                                        <button class="btn btn-sm" style="background:var(--inquiry); min-width:180px;" onclick="processQueuedMedicinePhotos()">Import Photo Queue</button>
                                                        <div style="font-size:12px; color:#555; display:flex; gap:6px; align-items:center; min-width:180px;">
                                                            <span>Reads packaging, creates inventory item, stores photo in record.</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="dev-tag" style="margin-bottom:6px;">dev:med-photo-queue</div>
                                                <div id="med-photo-queue" style="display:flex; flex-direction:column; gap:10px;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="medication-list"></div>
                            </div>
                        </div>
                        <div class="collapsible">
                            <div id="equipment-section-header" class="col-header crew-med-header" data-sidebar-id="equipment-section" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                <span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Devices and Equipment</span><span class="dev-tag">dev:equipment-shell</span>
                            </div>
                            <div class="col-body" style="padding:12px; display:none;">
                                <div id="equipment-add-container" class="collapsible" style="margin-bottom:12px;">
                                    <div id="equipment-add-header" class="col-header crew-med-header" data-sidebar-id="equipment-add" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                    <span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Add Medical Equipment Item</span><span class="dev-tag">dev:equipment-add</span>
                                    </div>
                                    <div id="equipment-add-body" class="col-body" style="padding:12px; background:#f8f9fa; display:none;">
                                        <div class="dev-tag" style="margin-bottom:8px;">dev:equipment-add-form</div>
                                        <div style="display:grid; grid-template-columns: repeat(2, minmax(240px, 1fr)); gap:10px; margin-bottom:10px;">
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Medical Equipment Name *</label>
                                                <input id="eq-new-name" type="text" style="width:100%; padding:8px;" placeholder="e.g., Oxygen Concentrator">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Category *</label>
                                                <input id="eq-new-cat" type="text" style="width:100%; padding:8px;" placeholder="Diagnostic, Surgical, etc.">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Type</label>
                                                <select id="eq-new-type" style="width:100%; padding:8px;">
                                                    <option value="durable">Durable (reusable)</option>
                                                    <option value="consumable">Consumable (one-time)</option>
                                                    <option value="medication">Medication</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Storage Location</label>
                                                <input id="eq-new-loc" type="text" style="width:100%; padding:8px;" placeholder="Medical Bag 1, Locker B">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Sub-Location / Kit</label>
                                                <input id="eq-new-subloc" type="text" style="width:100%; padding:8px;" placeholder="Inside Airway pouch">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Parent Kit ID</label>
                                                <input id="eq-new-parent" type="text" style="width:100%; padding:8px;" placeholder="Medical Bag 1">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Current Status</label>
                                                <select id="eq-new-status" style="width:100%; padding:8px;">
                                                    <option value="In Stock">In Stock</option>
                                                    <option value="In Use">In Use</option>
                                                    <option value="Sterilizing">Sterilizing</option>
                                                    <option value="Damaged/Out of Service">Damaged/Out of Service</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Sterilization / Expiry Date</label>
                                                <input id="eq-new-exp" type="date" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Last Inspection Date</label>
                                                <input id="eq-new-inspect" type="date" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Battery Type & Status</label>
                                                <input id="eq-new-batt" type="text" style="width:100%; padding:8px;" placeholder="2x AAA; changed Jan 2026">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Calibration Due Date</label>
                                                <input id="eq-new-cal" type="date" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Total Quantity</label>
                                                <input id="eq-new-qty" type="number" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Minimum Par Level</label>
                                                <input id="eq-new-par" type="number" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Supplier / Manufacturer</label>
                                                <input id="eq-new-sup" type="text" style="width:100%; padding:8px;" placeholder="Who to contact">
                                            </div>
                                            <div style="grid-column: span 2;">
                                                <label style="font-weight:700; font-size:12px;">Notes</label>
                                                <textarea id="eq-new-notes" style="width:100%; padding:8px; min-height:60px;"></textarea>
                                            </div>
                                        </div>
                                        <button onclick="addMedicalStore()" class="btn btn-sm" style="background:var(--dark); width:100%;">+ Add Medical Equipment Item</button>
                                    </div>
                                </div>
                                <div class="dev-tag" style="margin-bottom:6px;">dev:equipment-list</div>
                                <div id="equipment-list"></div>
                            </div>
                        </div>
                        <div class="collapsible">
                            <div class="col-header crew-med-header" data-sidebar-id="equipment-consumables-section" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                <span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Consumables</span><span class="dev-tag">dev:consumables-shell</span>
                            </div>
                            <div class="col-body" style="padding:12px; display:none;">
                                <div id="consumables-add-container" class="collapsible" style="margin-bottom:12px;">
                                    <div id="consumables-add-header" class="col-header crew-med-header" data-sidebar-id="equipment-consumables-add" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                        <span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Add Medical Supply</span><span class="dev-tag">dev:consumables-add</span>
                                    </div>
                                    <div id="consumables-add-body" class="col-body" style="padding:12px; background:#f8f9fa; display:none;">
                                        <div class="dev-tag" style="margin-bottom:8px;">dev:consumables-add-form</div>
                                        <div style="display:grid; grid-template-columns: repeat(2, minmax(240px, 1fr)); gap:10px; margin-bottom:10px;">
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Medical Supply Name *</label>
                                                <input id="cons-new-name" type="text" style="width:100%; padding:8px;" placeholder="e.g., Gauze Pads">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Category *</label>
                                                <input id="cons-new-cat" type="text" style="width:100%; padding:8px;" placeholder="Consumable">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Type</label>
                                                <select id="cons-new-type" style="width:100%; padding:8px;">
                                                    <option value="consumable">Consumable (one-time)</option>
                                                    <option value="durable">Durable (reusable)</option>
                                                    <option value="medication">Medication</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Storage Location</label>
                                                <input id="cons-new-loc" type="text" style="width:100%; padding:8px;" placeholder="Locker C">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Sub-Location / Kit</label>
                                                <input id="cons-new-subloc" type="text" style="width:100%; padding:8px;" placeholder="Drawer 2">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Parent Kit ID</label>
                                                <input id="cons-new-parent" type="text" style="width:100%; padding:8px;" placeholder="First Aid Kit">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Current Status</label>
                                                <select id="cons-new-status" style="width:100%; padding:8px;">
                                                    <option value="In Stock">In Stock</option>
                                                    <option value="In Use">In Use</option>
                                                    <option value="Sterilizing">Sterilizing</option>
                                                    <option value="Damaged/Out of Service">Damaged/Out of Service</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Expiry Date</label>
                                                <input id="cons-new-exp" type="date" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Last Inspection Date</label>
                                                <input id="cons-new-inspect" type="date" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Battery Type & Status</label>
                                                <input id="cons-new-batt" type="text" style="width:100%; padding:8px;" placeholder="n/a">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Calibration Due Date</label>
                                                <input id="cons-new-cal" type="date" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Total Quantity</label>
                                                <input id="cons-new-qty" type="number" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Minimum Par Level</label>
                                                <input id="cons-new-par" type="number" style="width:100%; padding:8px;">
                                            </div>
                                            <div>
                                                <label style="font-weight:700; font-size:12px;">Supplier / Manufacturer</label>
                                                <input id="cons-new-sup" type="text" style="width:100%; padding:8px;" placeholder="Vendor">
                                            </div>
                                            <div style="grid-column: span 2;">
                                                <label style="font-weight:700; font-size:12px;">Notes</label>
                                                <textarea id="cons-new-notes" style="width:100%; padding:8px; min-height:60px;"></textarea>
                                            </div>
                                        </div>
                                        <button onclick="addConsumableItem()" class="btn btn-sm" style="background:var(--dark); width:100%;">+ Add Consumable</button>
                                    </div>
                                </div>
                                <div class="dev-tag" style="margin-bottom:6px;">dev:consumables-list</div>
                                <div id="consumables-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="page-sidebar" data-tab="OnboardEquipment" onclick="toggleSidebar(this)">
                <button class="sidebar-toggle">Context â†’</button>
                        <div class="sidebar-content">
                            {% include 'sidebars/sidebar_equipment.html' %}
                </div>
            </div>
        </div>
    </div>
</div>

<div id="VesselCrewInfo" class="content">
    <div class="page-shell">
        <div class="page-body sidebar-open">
            <div class="page-main">
                <div class="page-shell">
                    <div class="panel-wrapper">
                <div class="collapsible" style="margin-bottom:15px;">
                    <div class="col-header crew-med-header" data-sidebar-id="vessel-info" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                        <span class="dev-tag">dev:vessel-info</span><span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Vessel Information</span>
                    </div>
                    <div class="col-body" style="padding:15px; background:#f8f9fa;">
                        <div class="dev-tag" style="margin-bottom:6px;">dev:vessel-fields</div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:12px; font-size:15px;">
                            <div>
                                <label style="font-size:12px; font-weight:bold; margin-bottom:4px; display:block;">Vessel Name</label>
                                <input type="text" id="vessel-name" style="padding:8px; width:100%;">
                            </div>
                            <div>
                                <label style="font-size:12px; font-weight:bold; margin-bottom:4px; display:block;">Registration Number</label>
                                <input type="text" id="vessel-registration" style="padding:8px; width:100%;">
                            </div>
                            <div>
                                <label style="font-size:12px; font-weight:bold; margin-bottom:4px; display:block;">Flag Country</label>
                                <input type="text" id="vessel-flag" style="padding:8px; width:100%;">
                            </div>
                            <div>
                                <label style="font-size:12px; font-weight:bold; margin-bottom:4px; display:block;">Home Port</label>
                                <input type="text" id="vessel-homeport" style="padding:8px; width:100%;">
                            </div>
                            <div>
                                <label style="font-size:12px; font-weight:bold; margin-bottom:4px; display:block;">Call Sign</label>
                                <input type="text" id="vessel-callsign" style="padding:8px; width:100%;">
                            </div>
                            <div>
                                <label style="font-size:12px; font-weight:bold; margin-bottom:4px; display:block;">Tonnage</label>
                                <input type="text" id="vessel-tonnage" style="padding:8px; width:100%;">
                            </div>
                            <div>
                                <label style="font-size:12px; font-weight:bold; margin-bottom:4px; display:block;">Crew Capacity</label>
                                <input type="text" id="vessel-crewcap" style="padding:8px; width:100%;">
                            </div>
                        </div>
                        <button onclick="saveVesselInfo()" class="btn btn-sm" style="background:var(--inquiry); width:100%;">Save Vessel Info</button>
                    </div>
                </div>
                <div class="collapsible" style="margin-bottom:15px;">
                    <div class="col-header crew-med-header" data-sidebar-id="crew-info" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                        <span class="dev-tag">dev:crew-info-shell</span><span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Crew Information</span>
                    </div>
                    <div class="col-body" style="padding:15px; background:#f8f9fa;">
                        <div class="collapsible" style="margin-bottom:15px;">
                            <div class="col-header crew-med-header" data-sidebar-id="crew-add" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                <span class="dev-tag">dev:crew-add</span><span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Add New Crew Member</span>
                            </div>
                            <div class="col-body" style="padding:15px; background:#f8f9fa;">
                            <div class="dev-tag" style="margin-bottom:6px;">dev:crew-add-fields</div>
                            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:8px; font-size:15px;">
                                <div><label style="font-size:13px; margin-bottom:2px;">First Name *</label><input type="text" id="cn-first" style="padding:6px; width:100%;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Middle Name(s)</label><input type="text" id="cn-middle" style="padding:6px; width:100%;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Last Name *</label><input type="text" id="cn-last" style="padding:6px; width:100%;"></div>
                            </div>
                            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:8px; font-size:15px;">
                                <div><label style="font-size:13px; margin-bottom:2px;">Sex *</label><select id="cn-sex" style="padding:6px; width:100%;">
                                    <option value="">Select...</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Non-binary">Non-binary</option>
                                    <option value="Other">Other</option>
                                    <option value="Prefer not to say">Prefer not to say</option>
                                </select></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Birthdate *</label><input type="date" id="cn-birthdate" style="padding:6px; width:100%;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Position *</label><select id="cn-position" style="padding:6px; width:100%;">
                                    <option value="">Select...</option>
                                    <option value="Captain">Captain</option>
                                    <option value="Crew">Crew</option>
                                    <option value="Passenger">Passenger</option>
                                </select></div>
                            </div>
                            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:8px; margin-bottom:8px; font-size:15px;">
                                <div><label style="font-size:13px; margin-bottom:2px;">Citizenship *</label><input type="text" id="cn-citizenship" list="countries" style="padding:6px; width:100%;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Passport Number *</label><input type="text" id="cn-passport" style="padding:6px; width:100%;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Issue Date</label><input type="date" id="cn-pass-issue" style="padding:6px; width:100%;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Expiry Date</label><input type="date" id="cn-pass-expiry" style="padding:6px; width:100%;"></div>
                            </div>
                            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:8px; margin-bottom:8px; font-size:15px;">
                                <div><label style="font-size:13px; margin-bottom:2px;">Cell/WhatsApp</label><input type="text" id="cn-phone" placeholder="+1234567890" style="padding:6px; width:100%;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Passport Photo/PDF</label><input type="file" id="cn-passport-photo" accept="image/*,.pdf" style="padding:4px; width:100%; font-size:13px;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Passport Page Photo/PDF</label><input type="file" id="cn-passport-page" accept="image/*,.pdf" style="padding:4px; width:100%; font-size:13px;"></div>
                            </div>
                            <div style="margin-bottom:8px;"><label style="font-size:12px; font-weight:bold;">Emergency Contact</label></div>
                            <div class="dev-tag" style="margin-bottom:6px;">dev:crew-add-emergency</div>
                            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:8px; margin-bottom:8px; font-size:15px;">
                                <div><label style="font-size:13px; margin-bottom:2px;">Name</label><input type="text" id="cn-emerg-name" style="padding:6px; width:100%;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Relationship</label><input type="text" id="cn-emerg-rel" style="padding:6px; width:100%;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Phone</label><input type="text" id="cn-emerg-phone" style="padding:6px; width:100%;"></div>
                                <div><label style="font-size:13px; margin-bottom:2px;">Email</label><input type="email" id="cn-emerg-email" style="padding:6px; width:100%;"></div>
                            </div>
                            <div style="margin-bottom:10px; font-size:15px;">
                                <label style="font-size:13px; margin-bottom:2px;">Emergency Contact Notes</label>
                                <input type="text" id="cn-emerg-notes" placeholder="Additional emergency contact information" style="padding:6px; width:100%;">
                            </div>
                            <datalist id="countries">
                                <option value="USA"><option value="Canada"><option value="UK"><option value="Australia"><option value="New Zealand"><option value="France"><option value="Germany"><option value="Spain"><option value="Italy"><option value="Netherlands"><option value="Singapore"><option value="Malaysia"><option value="Thailand"><option value="Philippines"><option value="Japan"><option value="China"><option value="India">
                            </datalist>
                            <button onclick="addCrew()" class="btn btn-sm" style="background:var(--dark); width:100%;">+ Add Crew Member</button>
                        </div>
                        </div>

                        <div id="crew-info-list"></div>
                    </div>
                </div>
                </div>
            </div>
        </div>
        <div class="page-sidebar" data-tab="VesselCrewInfo" onclick="toggleSidebar(this)">
            <button class="sidebar-toggle">Context â†’</button>
            <div class="sidebar-content">
                {% include 'sidebars/sidebar_vessel.html' %}
            </div>
        </div>
    </div>
</div>
</div>
<div id="Settings" class="content">
    <div class="page-shell">
                <div class="page-body sidebar-open">
            <div class="page-main">
                <div class="panel-wrapper">
                    <div class="collapsible" style="margin-bottom:12px;">
                        <div class="col-header crew-med-header" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                            <span class="dev-tag">dev:settings-usermode</span><span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¾</span><span style="font-weight:700;">User Mode</span>
                        </div>
                        <div class="col-body" style="padding:12px; background:#f8f9fa;">
                            <label for="user_mode">User Mode</label>
                            <select id="user_mode" style="padding:10px; min-width:200px;">
                                <option value="user">User</option>
                                <option value="advanced">Advanced</option>
                                <option value="developer">Developer</option>
                            </select>
                            <div style="margin-top:10px;">
                                <button class="btn btn-sm" style="background:#b23b00;" onclick="forceClearCache()"><span class="dev-tag">dev:cache-bust</span>Force Reload (Dev)</button>
                            </div>
                            <div style="margin-top:8px; font-size:12px; color:#555;">
                                User: hides advanced controls. Advanced: shows prompt tools. Developer: also shows dev tags.
                            </div>
                        </div>
                    </div>
                    <div class="collapsible">
                    <div class="col-header crew-med-header" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                        <span class="dev-tag">dev:settings-crew-creds</span><span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Crew Login Credentials</span>
                    </div>
                        <div class="col-body" style="padding:12px; background:#f8f9fa;">
                            <div id="crew-credentials"></div>
                        </div>
                    </div>
                    <div class="collapsible" style="margin-top:12px;">
                        <div class="col-header crew-med-header" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                            <span class="dev-tag">dev:settings-models</span><span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">MedGemma Model Parameters</span>
                        </div>
                        <div class="col-body" style="padding:12px; background:#f8f9fa;">
                            <div class="collapsible" style="margin-bottom:12px;">
                                <div class="col-header crew-med-header" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                    <span class="dev-tag">dev:settings-triage</span><span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Triage Mode (Clinical Response)</span>
                                </div>
                                <div class="col-body" style="padding:12px; background:#f8f9fa;">
                                    <label>Instruction Text Block</label>
                                    <textarea id="triage_instruction" style="height:120px;"></textarea>
                                    <div style="display:flex; gap:20px; margin-top:15px; align-items:center;">
                                        <div style="display:flex; align-items:center; gap:6px;">
                                            <span title="Temperature: higher = more random, lower = more deterministic." style="font-weight:700;">Temp:</span>
                                            <input type="number" id="tr_temp" step="0.1" style="width:60px;">
                                        </div>
                                        <div style="display:flex; align-items:center; gap:6px;">
                                            <span title="Max new tokens the model can generate in the response." style="font-weight:700;">Tokens:</span>
                                            <input type="number" id="tr_tok" style="width:80px;">
                                        </div>
                                        <div style="display:flex; align-items:center; gap:6px;">
                                            <span title="Top-P (nucleus sampling): lower = safer, higher = more diverse." style="font-weight:700;">Top-P:</span>
                                            <input type="number" id="tr_p" step="0.05" style="width:60px;">
                                        </div>
                                        <div style="margin-left:auto;">
                                            <button class="btn btn-sm" style="background:var(--inquiry);" onclick="resetSection('triage')">Reset to Default</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="collapsible" style="margin-bottom:12px;">
                                <div class="col-header crew-med-header" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                    <span class="dev-tag">dev:settings-inquiry</span><span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Inquiry Mode (Research/Academic)</span>
                                </div>
                                <div class="col-body" style="padding:12px; background:#f8f9fa;">
                                    <label>Instruction Text Block</label>
                                    <textarea id="inquiry_instruction" style="height:120px;"></textarea>
                                    <div style="display:flex; gap:20px; margin-top:15px; align-items:center;">
                                        <div style="display:flex; align-items:center; gap:6px;">
                                            <span title="Temperature: higher = more creative, lower = more factual." style="font-weight:700;">Temp:</span>
                                            <input type="number" id="in_temp" step="0.1" style="width:60px;">
                                        </div>
                                        <div style="display:flex; align-items:center; gap:6px;">
                                            <span title="Max new tokens the model can generate in the response." style="font-weight:700;">Tokens:</span>
                                            <input type="number" id="in_tok" style="width:80px;">
                                        </div>
                                        <div style="display:flex; align-items:center; gap:6px;">
                                            <span title="Top-P (nucleus sampling): lower = safer, higher = more diverse." style="font-weight:700;">Top-P:</span>
                                            <input type="number" id="in_p" step="0.05" style="width:60px;">
                                        </div>
                                        <div style="margin-left:auto;">
                                            <button class="btn btn-sm" style="background:var(--inquiry);" onclick="resetSection('inquiry')">Reset to Default</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="collapsible" style="margin-bottom:12px;">
                                <div class="col-header crew-med-header" onclick="toggleSection(this)" style="background:#fff; justify-content:flex-start;">
                                    <span class="dev-tag">dev:settings-mission</span><span class="detail-icon history-arrow" style="font-size:18px; margin-right:8px;">â–¸</span><span style="font-weight:700;">Mission Context (Informs Both Triage and Inquiry Modes)</span>
                                </div>
                                <div class="col-body" style="padding:12px; background:#f8f9fa;">
                                    <textarea id="mission_context" style="height:60px;"></textarea>
                                    <div style="margin-top:12px; display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px;">
                                        <button class="btn btn-sm" style="background:var(--inquiry);" onclick="resetSection('mission')">Reset to Default</button>
                                        <div id="settings-save-status" style="font-size:12px; color:#2c3e50; min-height:18px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="page-sidebar" data-tab="Settings" onclick="toggleSidebar(this)">
                <button class="sidebar-toggle">Context â†’</button>
                <div class="sidebar-content">
                    {% include 'sidebars/sidebar_settings.html' %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Phone-friendly medicine photo import overlay -->
<div id="phone-import-overlay">
    <div class="phone-import-panel">
        <div class="dev-tag" style="margin-bottom:6px;">dev:med-photo-mobile</div>
        <div style="display:flex; justify-content:center; margin-bottom:10px; margin-top:-6px;">
            <button class="btn" style="background:var(--red); font-size:16px;" onclick="closePhoneImportView()">Close Phone Photo Helper</button>
        </div>
        <div style="font-size:30px; color:#3a3a3a; margin-bottom:10px;">Use your phone camera to snap medicine packaging and import directly.</div>
        <div class="phone-import-actions">
            <div class="phone-import-step">Step 1: Take or pick photos</div>
            <input id="phone-med-photo-input" type="file" accept="image/*" multiple style="position:absolute; width:1px; height:1px; opacity:0; pointer-events:none;">
            <div id="phone-photo-count" style="font-size:28px; color:#2c3e50;">No photos selected.</div>
            <div id="phone-photo-preview" style="display:flex; flex-wrap:wrap; gap:8px;"></div>
            <button class="btn" style="background:var(--dark);" onclick="document.getElementById('phone-med-photo-input').click()">Choose / Take Photos</button>
            <div class="phone-import-step">Step 2: Queue the photo-group above to import one Medicine record</div>
            <button class="btn" style="background:var(--inquiry);" onclick="queuePhoneImportPhotos()">Add Above Photos to Queue</button>
            <div class="phone-import-step">Step 3: Import queue</div>
            <button class="btn" style="background:var(--inquiry);" onclick="processQueuedMedicinePhotos()">Import Photo Queue</button>
            <div style="font-size:12px; color:#555;">Reads packaging, creates inventory item, stores photo in record.</div>
        </div>
        <div style="font-weight:700; font-size:13px; margin-top:8px;">Queue status <span class="dev-tag">dev:med-photo-mobile-queue</span></div>
        <div id="phone-import-queue" style="margin-top:6px; display:flex; flex-direction:column; gap:8px;"></div>
    </div>
</div>

<script src="/static/js/chat.js?v=2017"></script>
<script src="/static/js/crew.js?v=2018"></script>
<script src="/static/js/pharmacy.js?v=2023"></script>
<script src="/static/js/equipment.js?v=2021"></script>
<script src="/static/js/settings.js?v=2022"></script>
<script src="/static/js/main.js?v=2019"></script>
</body>
</html>
