<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MedGemma Master v5.7</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --green: #2e7d32; --blue: #1565c0; --red: #c62828; --dark: #2c3e50; --bg: #f4f7f6; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .nav { background: var(--dark); display: flex; padding: 0 10px; height: 50px; align-items: center; flex-shrink: 0; }
        .tab { color: #bdc3c7; background: none; border: none; padding: 10px 15px; cursor: pointer; font-weight: bold; }
        .tab.active { color: white; background: var(--green); border-radius: 4px; }
        .content { flex-grow: 1; padding: 25px; overflow-y: auto; display: none; }
        
        .banner { padding: 12px 20px; color: white; font-weight: 900; display: flex; justify-content: space-between; border-radius: 8px 8px 0 0; background: var(--green); transition: 0.3s; }
        .banner.inquiry-mode { background: var(--blue); }
        .banner.private-mode { background: var(--red) !important; box-shadow: 0 0 15px var(--red); }

        .chat-area { max-width: 1100px; margin: 0 auto; background: white; border-radius: 8px; border: 1px solid #ddd; height: 85vh; display: flex; flex-direction: column; }
        .display { flex-grow: 1; padding: 20px; overflow-y: auto; }
        .response-block { border-left: 6px solid var(--green); padding: 15px; margin: 15px 0; background: #f9f9f9; }

        .collapsible { background: white; border: 1px solid #ddd; margin-bottom: 4px; border-radius: 4px; }
        .col-header { padding: 8px 12px; cursor: pointer; background: #f8f9fa; display: flex; justify-content: space-between; font-weight: bold; font-size: 14px; }
        .col-body { padding: 12px; display: none; }
        .compact-textarea { height: 80px; font-size: 13px; }
        .btn-row { display: flex; gap: 8px; margin-top: 10px; }
        .btn-sm { padding: 6px 12px; font-size: 13px; }
        .crew-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .btn { padding: 10px 20px; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: opacity 0.3s; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .config-card { background: white; padding: 25px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 20px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; color: var(--dark); }
        textarea { width: 100%; border: 1px solid #ccc; border-radius: 4px; padding: 10px; box-sizing: border-box; font-family: inherit; }
        
        .loading-indicator { color: #666; font-style: italic; padding: 10px; animation: pulse 1.5s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>

<div class="nav">
    <button class="tab active" onclick="showTab(event, 'Chat')">TRIAGE</button>
    <button class="tab" onclick="showTab(event, 'Crew')">CREW</button>
    <button class="tab" style="margin-left:auto; color:#ffd54f;" onclick="showTab(event, 'Settings')">CONFIG</button>
</div>

<div id="Chat" class="content" style="display:block">
    <div class="chat-area">
        <div id="banner" class="banner">
            <span id="banner-mode">TRIAGE MODE: ACTIVE</span>
            <span id="banner-priv">LOGGING: ENABLED</span>
        </div>
        <div style="padding:15px; background:#eee; display:flex; gap:10px;">
            <select id="mode-select" onchange="updateUI()" style="padding:10px; font-weight:bold;">
                <option value="triage">ðŸš¨ TRIAGE</option>
                <option value="inquiry">ðŸ“˜ INQUIRY</option>
            </select>
            <select id="p-select" style="padding:10px; flex-grow:1;"></select>
            <select id="model-select" style="padding:10px; min-width:200px;"><option value="google/medgemma-1.5-4b-it">medgemma-1.5-4b-it</option><option value="google/medgemma-1.5-28b-it">medgemma-1.5-28b-it</option></select>
            <button onclick="togglePriv()" id="priv-btn" class="btn" style="background:#555;">PRIVACY: OFF</button>
        </div>
        <div id="display" class="display"></div>
        <div style="padding:15px; background:#f4f4f4;">
            <textarea id="msg" style="height:70px;" placeholder="Clinical notes... (Enter to submit, Shift+Enter for new line)"></textarea>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button onclick="runChat()" id="run-btn" class="btn" style="flex-grow:1; background:var(--green);">RUN ANALYSIS</button>
                <button onclick="repeatLast()" id="repeat-btn" class="btn" style="background:#555;">REPEAT LAST</button>
            </div>
        </div>
    </div>
</div>

<div id="Settings" class="content">
    <div style="max-width:900px; margin:auto;">
        <div class="config-card" style="border-top: 5px solid var(--green);">
            <h3>Triage Mode (Clinical Response)</h3>
            <label>Instruction Text Block</label>
            <textarea id="triage_instruction" style="height:120px;"></textarea>
            <div style="display:flex; gap:20px; margin-top:15px;">
                <div>Temp: <input type="number" id="tr_temp" step="0.1" style="width:60px;"></div>
                <div>Tokens: <input type="number" id="tr_tok" style="width:80px;"></div>
                <div>Top-P: <input type="number" id="tr_p" step="0.05" style="width:60px;"></div>
            </div>
        </div>

        <div class="config-card" style="border-top: 5px solid var(--blue);">
            <h3>Inquiry Mode (Research/Academic)</h3>
            <label>Instruction Text Block</label>
            <textarea id="inquiry_instruction" style="height:120px;"></textarea>
            <div style="display:flex; gap:20px; margin-top:15px;">
                <div>Temp: <input type="number" id="in_temp" step="0.1" style="width:60px;"></div>
                <div>Tokens: <input type="number" id="in_tok" style="width:80px;"></div>
                <div>Top-P: <input type="number" id="in_p" step="0.05" style="width:60px;"></div>
            </div>
        </div>

        <div class="config-card">
            <label>Global Mission Context</label>
            <textarea id="mission_context" style="height:60px;"></textarea>
            <button onclick="saveSettings()" class="btn" style="width:100%; background:var(--dark); margin-top:20px;">SYNC SYSTEM PARAMETERS</button>
        </div>
    </div>
</div>

<div id="Crew" class="content">
    <div class="crew-header">
        <h3 style="margin:0;">Crew Intake Information</h3>
        <div style="display:flex; gap:8px;">
            <select id="crew-sort" onchange="loadData()" style="padding:6px 12px; font-size:13px;">
                <option value="last">Sort: Last Name</option>
                <option value="first">Sort: First Name</option>
                <option value="birthdate-asc">Sort: Birthdate (Youngest First)</option>
                <option value="birthdate-desc">Sort: Birthdate (Oldest First)</option>
            </select>
            <button onclick="exportCrewList()" class="btn btn-sm" style="background:var(--blue);">ðŸ“‹ Crew List CSV</button>
            <button onclick="exportAllCrew()" class="btn btn-sm" style="background:var(--blue);">ðŸ“¤ Export All</button>
        </div>
    </div>
    <div class="collapsible" style="margin-bottom:15px;">
        <div class="col-header" onclick="toggleSection(this)" style="background:#e3f2fd; justify-content:flex-start;">
            <span style="font-size:14px; margin-right:8px;">âž•</span><span>Add New Crew Member</span>
        </div>
        <div class="col-body" style="padding:15px; background:#f8f9fa;">
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:8px; font-size:13px;">
            <div><label style="font-size:11px; margin-bottom:2px;">First Name *</label><input type="text" id="cn-first" style="padding:6px; width:100%;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Middle Name(s)</label><input type="text" id="cn-middle" style="padding:6px; width:100%;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Last Name *</label><input type="text" id="cn-last" style="padding:6px; width:100%;"></div>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:8px; font-size:13px;">
            <div><label style="font-size:11px; margin-bottom:2px;">Sex *</label><select id="cn-sex" style="padding:6px; width:100%;">
                <option value="">Select...</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Non-binary">Non-binary</option>
                <option value="Other">Other</option>
                <option value="Prefer not to say">Prefer not to say</option>
            </select></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Birthdate *</label><input type="date" id="cn-birthdate" style="padding:6px; width:100%;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Position *</label><select id="cn-position" style="padding:6px; width:100%;">
                <option value="">Select...</option>
                <option value="Captain">Captain</option>
                <option value="Crew">Crew</option>
                <option value="Passenger">Passenger</option>
            </select></div>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:8px; margin-bottom:8px; font-size:13px;">
            <div><label style="font-size:11px; margin-bottom:2px;">Citizenship *</label><input type="text" id="cn-citizenship" list="countries" style="padding:6px; width:100%;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Passport Number *</label><input type="text" id="cn-passport" style="padding:6px; width:100%;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Issue Date</label><input type="date" id="cn-pass-issue" style="padding:6px; width:100%;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Expiry Date</label><input type="date" id="cn-pass-expiry" style="padding:6px; width:100%;"></div>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:8px; font-size:13px;">
            <div><label style="font-size:11px; margin-bottom:2px;">Cell/WhatsApp</label><input type="text" id="cn-phone" placeholder="+1234567890" style="padding:6px; width:100%;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Passport Photo/PDF</label><input type="file" id="cn-passport-photo" accept="image/*,.pdf" style="padding:4px; width:100%; font-size:11px;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Passport Page Photo/PDF</label><input type="file" id="cn-passport-page" accept="image/*,.pdf" style="padding:4px; width:100%; font-size:11px;"></div>
        </div>
        <div style="margin-bottom:8px;"><label style="font-size:12px; font-weight:bold;">Emergency Contact</label></div>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:8px; margin-bottom:8px; font-size:13px;">
            <div><label style="font-size:11px; margin-bottom:2px;">Name</label><input type="text" id="cn-emerg-name" style="padding:6px; width:100%;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Relationship</label><input type="text" id="cn-emerg-rel" style="padding:6px; width:100%;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Phone</label><input type="text" id="cn-emerg-phone" style="padding:6px; width:100%;"></div>
            <div><label style="font-size:11px; margin-bottom:2px;">Email</label><input type="email" id="cn-emerg-email" style="padding:6px; width:100%;"></div>
        </div>
        <div style="margin-bottom:10px; font-size:13px;">
            <label style="font-size:11px; margin-bottom:2px;">Emergency Contact Notes</label>
            <input type="text" id="cn-emerg-notes" placeholder="Additional emergency contact information" style="padding:6px; width:100%;">
        </div>
        <datalist id="countries">
            <option value="USA"><option value="Canada"><option value="UK"><option value="Australia"><option value="New Zealand"><option value="France"><option value="Germany"><option value="Spain"><option value="Italy"><option value="Netherlands"><option value="Singapore"><option value="Malaysia"><option value="Thailand"><option value="Philippines"><option value="Japan"><option value="China"><option value="India">
        </datalist>
        <button onclick="addCrew()" class="btn btn-sm" style="background:var(--dark); width:100%;">+ Add Crew Member</button>
    </div>

    <div id="crew-list"></div>
</div>

<script src="/static/js/chat.js?v=1005"></script>
<script src="/static/js/crew.js?v=1005"></script>
<script src="/static/js/settings.js?v=1005"></script>
<script src="/static/js/main.js?v=1005"></script>
</body>
</html>
